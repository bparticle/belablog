---
import Base from '@/layouts/Base.astro';
import Section from '@/components/Section.astro';
import Card from '@/components/Card.astro';
import { getCollection } from 'astro:content';
import { AppConfig } from '@/utils/AppConfig';

const posts = await getCollection('posts');
---

<Base head={{ title: `Search | ${AppConfig.title}`, description: AppConfig.description }}>
  <Section>
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold mb-4">Search Posts</h1>
      <p class="text-xl text-gray-600 dark:text-gray-400">Find what you're looking for</p>
    </div>
    
    <div class="mb-8">
      <input 
        type="text" 
        id="search-input"
        placeholder="Search posts..."
        class="w-full max-w-md mx-auto px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-orange-500"
      />
    </div>
    
    <div id="search-results" class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
      {posts.map((post) => <Card post={post} />)}
    </div>
  </Section>
</Base>

<script>
  const searchInput = document.getElementById('search-input') as HTMLInputElement;
  const searchResults = document.getElementById('search-results');
  const allPosts = Array.from(searchResults?.children || []);

  if (searchInput && searchResults) {
    searchInput.addEventListener('input', (e) => {
      const target = e.target as HTMLInputElement;
      const query = target.value.toLowerCase();
      
      allPosts.forEach((postCard) => {
        const titleElement = postCard.querySelector('p');
        const descriptionElement = postCard.querySelector('.line-clamp-6');
        
        const title = titleElement?.textContent?.toLowerCase() || '';
        const description = descriptionElement?.textContent?.toLowerCase() || '';
        
        if (title.includes(query) || description.includes(query)) {
          (postCard as HTMLElement).style.display = 'block';
        } else {
          (postCard as HTMLElement).style.display = 'none';
        }
      });
    });
  }
</script> 