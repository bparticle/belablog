---
import Base from '@/layouts/Base.astro';
import Section from '@/components/Section.astro';
import { getCollection } from 'astro:content';
import { AppConfig } from '@/utils/AppConfig';

const categories = await getCollection('categories');
const posts = await getCollection('posts');

// Count posts per category
const categoryCounts: Record<string, number> = {};
posts.forEach(post => {
  if (post.data.categories) {
    post.data.categories.forEach(category => {
      categoryCounts[category] = (categoryCounts[category] || 0) + 1;
    });
  }
});
---

<Base head={{ title: `Categories | ${AppConfig.title}`, description: AppConfig.description }}>
  <Section>
    <div class="text-center mb-12">
      <h1 class="text-4xl font-bold mb-4">Categories</h1>
      <p class="text-xl text-gray-600 dark:text-gray-400">Browse posts by category</p>
    </div>
    
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
      {categories.map((category) => {
        const postCount = categoryCounts[category.data.title] || 0;
        return (
          <a href={`/categories/${category.id}`} class="block">
            <div class="h-full rounded-2xl bg-stone-200/50 from-orange-900 via-amber-700 to-white p-[1px] text-sm shadow-[inset_0_0_0_1px_rgba(255,255,255,0.4)] hover:bg-gradient-to-r dark:bg-gray-900">
              <div class="flex h-full w-full flex-col rounded-[1rem] bg-stone-300 p-6 text-gray-900 opacity-90 dark:bg-stone-800 dark:text-white">
                <h3 class="text-xl font-bold mb-2">{category.data.title}</h3>
                {category.data.description && (
                  <p class="text-gray-600 dark:text-gray-400 mb-4 flex-1">
                    {category.data.description}
                  </p>
                )}
                <div class="text-sm font-medium text-orange-600 dark:text-orange-400">
                  {postCount} posts
                </div>
              </div>
            </div>
          </a>
        );
      })}
    </div>
  </Section>
</Base>