---
import { getCollection } from 'astro:content';
import Base from '@/layouts/Base.astro';
import Section from '@/components/Section.astro';
import Tags from '@/components/Tags.astro';
import { formatDate } from '@/utils/data.util';
import { AppConfig } from '@/utils/AppConfig';

// Get the slug from the URL
const { slug } = Astro.params;

// Get all posts and find the one with matching slug
const posts = await getCollection('posts');
const post = posts.find(p => p.slug === slug);

// If post not found, redirect to 404
if (!post) {
  return Astro.redirect('/404');
}

const { Content } = await post.render();
---

<Base head={{ 
  title: `${post.data.title} | ${AppConfig.title}`, 
  description: post.data.description || AppConfig.description 
}}>
  <Section>
    <article class="prose prose-lg dark:prose-invert prose-stone mx-auto">
      <header class="mb-8">
        <div class="flex items-center gap-2 mb-4 text-sm text-gray-600 dark:text-gray-400">
          <time datetime={post.data.date.toISOString()}>
            {formatDate(post.data.date.toISOString())}
          </time>
          {post.data.minutesRead && (
            <span>â€¢ {post.data.minutesRead}</span>
          )}
        </div>
        
        <h1 class="text-4xl font-bold mb-4">{post.data.title}</h1>
        
        {post.data.description && (
          <p class="text-xl text-gray-600 dark:text-gray-400 mb-6">
            {post.data.description}
          </p>
        )}
        
        {post.data.image && (
          <div class="mb-8">
            <img 
              src={`/posts/${post.slug}/${post.data.image}`} 
              alt={post.data.title}
              class="w-full h-auto rounded-lg"
            />
          </div>
        )}
        
        {post.data.tags && post.data.tags.length > 0 && (
          <div class="mb-8">
            <Tags tags={post.data.tags} withHref={true} />
          </div>
        )}
      </header>
      
      <div class="prose prose-lg dark:prose-invert prose-stone max-w-none">
        <Content />
      </div>
    </article>
  </Section>
</Base> 